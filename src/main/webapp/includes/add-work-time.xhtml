<?xml version="1.0" encoding="UTF-8"?>

<div id="add-work-time" class="modal modal-main fade"
     xmlns="http://www.w3.org/1999/xhtml"
     xmlns:h="http://xmlns.jcp.org/jsf/html"
     xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
     xmlns:f="http://xmlns.jcp.org/jsf/core"
     xmlns:p="http://xmlns.jcp.org/jsf/passthrough"
     xmlns:jsf="http://xmlns.jcp.org/jsf">


    <div>
        <a class="modal-close" data-dismiss="modal"> <i class="fa fa-times"></i> </a>
        <div>
            <h:form id="add-work-time-form" prependId="false">

                <div class="modal-content">
                    <div class="container-resp">
                        <div class="form-top col1-4">
                            <label>Klient</label>
                            <h:selectOneMenu id="add-work-time-client"
                                             converter="javax.faces.Long"
                                             value="#{workTimeBean.clientId}">
                                <f:selectItems
                                        value="#{workTimeBean.clients}"
                                        var="c"
                                        itemValue="#{c.id}"
                                        itemLabel="#{c.name}"/>

                                <f:ajax event="change"
                                        execute="@this"/>

                            </h:selectOneMenu>
                        </div>

                        <div class="form-top col1-3">
                            <label>Dzień pracy</label>
                            <h:inputText id="add-work-time-date"
                                         styleClass="datepicker"
                                         label="#{workTimeBean.dateTime}"
                                         value="#{workTimeBean.dateTime}">
                                <f:convertDateTime pattern="yyyy-MM-dd"/>

                                <f:ajax event="change"
                                        delay="300"
                                        execute="@this"/>
                            </h:inputText>

                            <h:outputScript>

                                $(".datepicker").flatpickr({
                                    enableTime: true,
                                    dateFormat: "Y-m-d",
                                    time_24hr: true
                                });

                                tippy('[data-tippy-content]');

                            </h:outputScript>
                        </div>
                        <div class="form-top col1-4">
                            <label>Ilość godzin</label>
                            <h:selectOneMenu id="add-work-time-time"
                                             value="#{workTimeBean.groupHours}">
                                <f:selectItems value="#{workTimeBean.hour}"
                                               var="d"
                                               itemLabel="#{common_msg['day_'.concat(d.name())]}"
                                               itemValue="#{d.number}"/>
                                <f:ajax event="change"
                                        execute="@this"
                                        render="add-work-table-id"
                                        onevent="showLoader"/>
                            </h:selectOneMenu>

                        </div>
                    </div>
                    <div class="table" jsf:id="add-work-table-id">
                        <table>
                            <thead>
                            <tr>
                                <th class="w10 left">Firma</th>
                                <th class="w10 left">Nazwisko i Imię</th>
                                <th class="w5 left">Godziny</th>
                            </tr>
                            </thead>
                            <tbody>
                            <ui:repeat value="#{workTimeBean.employees}" var="e">
                                <tr>
                                    <td class="w10 left">
                                        #{e.companyName}
                                    </td>
                                    <td class="w10 left">
                                        <h4>#{e.lastName} #{e.firstName}</h4>
                                    </td>
                                    <td class="w5">
                                        <div class="">
                                            <h:commandLink action="#{workTimeBean.minusHour(e)}">
                                                <f:ajax execute="@this"
                                                        render="add-work-table-id"/>
                                                <i class="fas fa-minus"></i>
                                            </h:commandLink>

                                            #{workTimeBean.employeeHour(e)}

                                            <h:commandLink action="#{workTimeBean.plusHour(e)}">
                                                <f:ajax execute="@this"
                                                        render="add-work-table-id"/>
                                                <i class="fas fa-plus"></i>
                                            </h:commandLink>
                                        </div>
                                    </td>
                                </tr>
                            </ui:repeat>
                            </tbody>
                        </table>
                    </div>
                    <hr></hr>
                    <div class="modal-footer">
                        <input type="submit"
                               class="btn col-success bordered fa fa-check"
                               value="Zapisz"
                               jsf:action="#{workTimeBean.saveTime}">
                            <f:ajax execute="@form"
                                    render="calendarForm closeDialogDiv"/>
                        </input>
                    </div>
                </div>
            </h:form>
        </div>
    </div>
</div>